# 网格分离助手
这是一个配合[网格组管理脚本](https://www.caimogu.cc/post/1081209.html)的blender插件，能够帮你把网格拆成许多碎片，用于制作怪猎曙光mod。

## 第一步：分离预览
选中一个网格，设置参数，然后点击`分离预览`。

对于一些复杂且面数多的模型，如下图安卡希雅的衣服，上面有很多小饰品，这些小饰品还分很多松散块，这样会占据很多组数，让插件用缝合边划分这些小饰品我觉得没什么意义。

![1.png](https://github.com/dddder4/Split-Mesh-Helper/blob/main/image/1.png)

建议按松散块分离，然后只挑出大块的作为主体，合并后对主体用插件。小饰品之间按需求互相合并，然后可以先放着不管。下图只是展示分离结果，不需要移动，左边是小饰品，右边是主体。

![2.png](https://github.com/dddder4/Split-Mesh-Helper/blob/main/image/2.png)

### 预期组数
指你希望插件把模型划分成多少份，数字越大越不准确，我建议可以先给个100看看，再进行微调。安卡希雅的衣服主体大概3万个面，我给的120。

### 最大组数
在预览执行过程中如果超过最大组数会停止划分并清除所有缝合边，你可以根据需求设置。Reframework里记录的曙光最大Group编号是254。

### 分离预览
插件会在每次打开blender后第一次使用`分离预览`时尝试打开控制台以显示进度，但是blender提供的`切换系统控制台`非常不好用，如果已经打开了控制台则会关闭。

![3.png](https://github.com/dddder4/Split-Mesh-Helper/blob/main/image/3.png)

接下来插件会清除模型原来的缝合边，在模型上标记新的缝合边用于第二步的分离。

![4.png](https://github.com/dddder4/Split-Mesh-Helper/blob/main/image/4.png)

上图可以看到安卡希雅背后的两条带子一大块都没有划分，我想再分细点，可以单独分离出来，单独设置参数，再进行分离预览，最后和主体合并。

![5.png](https://github.com/dddder4/Split-Mesh-Helper/blob/main/image/5.png)

最后的效果如下。一些标得不好看的缝合边可以自己增删改，确认无误后进行第二步。

![6.png](https://github.com/dddder4/Split-Mesh-Helper/blob/main/image/6.png)

## 第二步：确认分离
选中一个网格，设置一堆参数，然后点击确认分离。

### 排序方向
用来规定模型消失或出现的大致方向。

### 反向
反转排序方向。`-X到X`变成`X到-X`，其他同理。

### 轴细分
用来规定模型消失或出现的随机部分。确定好一个排序方向后，可以对剩下两个坐标轴做细分，细分的目标是模型的边界范围。

![7.png](https://github.com/dddder4/Split-Mesh-Helper/blob/main/image/7.png)

我的排序方向是-Z到Z，XY细分给的2，那么俯视图看起来会像这个样子，和细分一个方块一样。

![8.png](https://github.com/dddder4/Split-Mesh-Helper/blob/main/image/8.png)

这样边界范围就被划分成了9个区域，[网格组管理脚本](https://www.caimogu.cc/post/1081209.html)在每次触发判定的时候，会在9个区域内随机挑选一个区域，再执行消失或出现。

### 重命名
如果激活的物体已经按照LOD_1_Group_x_Sub_x__xxx的格式命名，插件会自动填写`开始组号`、`材质编号`、`材质名称`。

#### 开始组号
对应Group后面的数字。

#### 材质编号
对应Sub后面的数字。

#### 材质名称
对应双下划线之后的材质名称。

### 确定分离
点击`确定分离`，插件会新建两个集合存放分离结果，不会破坏原来的模型。

Split Mesh Result里存放的是带骨架的分离结果，而Split Mesh Loose里存放的是不带骨架的松散块网格。Result里的网格会添加数据传递修改器来消除模型接缝，对象就是Loose里面的网格。数据传递修改器要放在骨架修改器之后，而且不需要应用，除非你知道你在干什么。

控制台会输出根据参数生成的Rule，可以直接复制拿走。


## 额外
一些用来修补小问题的额外功能。

### 合并骨架
如果你对多个网格分别使用了`确定分离`生成了多个骨架，又想把它们整合到一个骨架里，可以用这个功能。

需要选中至少两个骨架。把选中骨架下面的网格移到激活骨架下面。网格必须要有名为"split_mesh_modifier"的修改器，通常情况下是插件分离时自动添加的数据传递修改器。

### 重命名
需要选中至少一个网格。把选中网格按照`开始组号`、`材质编号`、`材质名称`进行重命名。

选中安卡希雅衣服前面分离出来的小饰品，执行骨架形变之后选中骨架下所有的网格，重命名。

